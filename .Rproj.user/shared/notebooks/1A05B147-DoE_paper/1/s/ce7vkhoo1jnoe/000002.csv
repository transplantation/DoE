"0","## In the following lines, we want to find variables that are not used after 2000 or they were added after 2000."
"0","# Frist, we removes whitespace from start and end of each element in the variable VAR.END.DATE"
"0","var.end.dates <- trimws(heart.form$VAR.END.DATE) %>% str_trim()"
"0",""
"0","# Second, identify the varaibles that are still used. "
"0","names.of.var.did.not.end <- heart.form[which(var.end.dates==""""), 1] "
"0",""
"0","# Make sure ID is included."
"0","names.of.var.did.not.end <- c(as.character(names.of.var.did.not.end), ""ID"")"
"0",""
"0","# Third, identify the variables that are not used now."
"0","vars_ended <- heart.form[which(heart.form$VARIABLE.NAME %in% names(heart.df)[!(names(heart.df) %in% names.of.var.did.not.end)]),(1:2)]"
"0",""
"0","# Figure out which date each variable was added"
"0","vars.added.dates <- heart.form$VAR.START.DATE %>% as.character.Date()"
"0",""
"0","# Fix an error from the information, there were two dates corresponding to one variable. We chose the later date. "
"0","vars.added.dates[which(vars.added.dates==""01-Oct-87, 01-Oct-90"")] <- ""01-Oct-90"""
"0",""
"0","# Figure out which year each variable was added and add this information to the heart form"
"0","heart.form$YR_ADDED <- sapply(vars.added.dates, function(x) str_extract_all(x,""[0-9]{1,2}"")[[1]][2]) %>% as.integer()"
"0",""
"0","# available variables added before 2000 and they are still used now"
"0","vars.added.before.2000 <- subset(heart.form, YR_ADDED>=87, select = c(1))  "
"0","vars.added.NA <- subset(heart.form,is.na(YR_ADDED),select = c(1))"
"0","vars.added.all <- rbind(vars.added.before.2000,vars.added.NA)"
"0","vars.added.all <- vars.added.all[[""VARIABLE.NAME""]] %>% "
"0","  as.character()"
"0",""
"0","vars.added.all <- c(as.character(vars.added.all), ""ID"")"
"0",""
"0","# Based on the criteria we have to find a subset of data: getting rid of variables that are ended and patients who were under 18 or too light or too short or didn't have a heart transplant."
"0",""
"0","heart.df.cleaned <- subset(heart.df, WL_ORG==""HR"") %>% # Heart "
"0","  subset(AGE>=18) %>% # Adults only"
"0","  # we excluded too light or too short people "
"0","  subset(WGT_KG_DON_CALC >= quantile(WGT_KG_DON_CALC, 0.0001, na.rm = TRUE)) %>% "
"0","  subset(WGT_KG_TCR >= quantile(WGT_KG_TCR, 0.0001, na.rm = TRUE)) %>%"
"0","  subset(HGT_CM_DON_CALC >= quantile(HGT_CM_DON_CALC, 0.0001, na.rm = TRUE)) %>% "
"0","  subset(HGT_CM_TCR >= quantile(HGT_CM_TCR, 0.0001, na.rm = TRUE)) %>% "
"0","  subset(select=intersect(names.of.var.did.not.end,vars.added.all))"
"0",""
"0","# Find variables that are related to dates"
"0","vars_discarded <- heart.form %>% "
"0","  subset(INTERPRETATION_TYPE==""D"", select=c(1,2))"
"0","heart.discard <- vars_discarded$VARIABLE.NAME %>% as.character()"
"0",""
"0","# Identify the variables that are related to dates in the data and remove them"
"0","heart.discard <- intersect(heart.discard, colnames(heart.df.cleaned))"
"0",""
"0","heart.df.cleaned <- select(heart.df.cleaned, -heart.discard) "
"0",""
